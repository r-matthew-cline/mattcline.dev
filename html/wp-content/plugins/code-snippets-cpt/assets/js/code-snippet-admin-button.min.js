/** Code Snippets CPT - v2.1.0 - 2017-04-05 | http://dsgnwrks.pro | Copyright (c) 2017; | Licensed GPLv2+ **/
window.wp=window.wp||{},window.codeSnippetCPTButton=window.codeSnippetCPTButton||{},function(a,b,c,d,e,f,g,h){"use strict";f.$={},f.isVisual=!1,f.postID=0;var i=!1,j=!1,k=13,l=function(a){return c(b.getElementById(a))};f.cache=function(){i||(f.$.htmlBody=c("html, body"),f.$.formWrap=l("snippet-cpt-form"),f.$.select=l("snippet-cpt-posts"),f.$.check=l("snippet-cpt-line-nums").add(l("snippet-cpt-line-nums-2")),f.$.none=l("no-snippets-exist"),f.postID=l("post_ID").val()||0,f.$.errorBlock=c(".snippet-cpt-errors p"),f.$.overlay=c(".snippet-overlay"),f.$.form=l("cpt-snippet-form"),f.$.selectSnippet=f.$.form.find("fieldset.select-a-snippet"),f.$.addSnippetSection=f.$.form.find("fieldset.add-new-snippet"),f.$.addNew=f.$.form.find(".add-new-snippet-btn"),f.$.cancelNew=f.$.form.find(".cancel-new-snippet-btn"),f.$.snippetTitle=f.$.form.find("#new-snippet-title"),f.$.snippetID=f.$.form.find("#edit-snippet-id"),f.$.snippetContent=f.$.form.find("#new-snippet-content"),i=!0)},f.create=function(){var a=c(this);a.parent().find(".ui-dialog-buttonpane button:last-child").focus(),a.keypress(function(b){var c=b.target.tagName in{INPUT:1,TEXTAREA:1};c||k!==b.keyCode||(b.preventDefault(),a.parent().find(".ui-dialog-buttonpane button:last-child").click())})},f.close=function(){f.$.select.prop("selectedIndex",0),f.resetErrorBlock(),j&&(g.editor.getSession().setValue(""),f.$.addNew.prop("disabled",!1),f.$.addSnippetSection.hide(),f.$.selectSnippet.show(),f.$.errorBlock.hide(),f.$.overlay.hide(),j=!1),f.$.form.trigger("reset"),f.mainBtn().text(f.l10n.btn_insert)},f.resetErrorBlock=function(){f.$.errorBlock.text("").hide()},f.cancel=function(){f.$.formWrap.dialog("close")},f.insert=function(){if(f.resetErrorBlock(),!j)return f.insertShortcode(f.buildShortcode(f.$.select.val(),f.$.check.is(":checked"),f.$.select.find(":selected").data("lang")));if(!f.$.snippetTitle.val()||!f.$.snippetContent.val())return f.displayErrorMessage(f.l10n.missing_required);var b={action:"snippetcpt_insert_snippet",nonce:f.snippet_nonce,data:f.$.form.serialize()};return f.$.overlay.show(),c.post(a.ajaxurl,b,function(a){if(f.$.overlay.hide(),a.success&&a.data){var b=a.data;f.insertShortcode(f.buildShortcode(b.post_name,b.line_numbers,b.lang))}else f.displayErrorMessage(a.data||"")},"json").fail(function(){f.displayErrorMessage()}),!0},f.displayErrorMessage=function(a){a||(a=f.l10n.general_error),f.$.errorBlock.slideUp(100,function(){f.$.errorBlock.text(a).slideDown(100)}),f.$.htmlBody.animate({scrollTop:f.$.errorBlock.offset().top-50})},f.buildShortcode=function(a,b,c){if(!a)return"";var d="[snippet slug="+a;return b||(d+=" line_numbers=false"),c&&(d+=" lang="+c),d+="]"},f.insertShortcode=function(a){return 0<f.$.none.length&&!j?(f.displayErrorMessage(f.l10n.no_snippets),f.$.overlay.hide(),!1):a?("function"==typeof f.isVisual?f.isVisual(a,!0):f.isVisual&&f.visualMode?f.visualMode.execCommand("mceInsertContent",0,a):e.insertContent(a),f.$.formWrap.dialog("close"),f.isVisual=!1,!0):(f.$.overlay.hide(),j?f.displayErrorMessage(f.l10n.missing_required):f.displayErrorMessage(f.l10n.select_snippet),!1)},f.showAddNew=function(a){a&&a.preventDefault&&a.preventDefault(),f.resetErrorBlock(),f.$.addNew.prop("disabled",!0),f.$.selectSnippet.slideUp(100,function(){f.$.addSnippetSection.slideDown(200,function(){f.$.cancelNew.fadeIn(),j=!0})})},f.cancelAddNew=function(a){a.preventDefault(),f.resetErrorBlock(),f.$.addNew.prop("disabled",!1),f.$.selectSnippet.slideDown(200,function(){f.$.addSnippetSection.slideUp(100,function(){f.$.cancelNew.fadeOut(),j=!1})})},f.open=function(a){f.cache(),f.isVisual=a,f.$.formWrap.dialog("open")},f.mainBtn=function(){return f.$.btn=f.$.btn||f.$.formWrap.next().find(".ui-button-text:contains("+f.l10n.btn_insert+")").parent().addClass("button-primary"),f.$.btn},f.mceView={action:"snippet_parse_shortcode",state:[],initialize:function(){var a=this,b="";a.url&&(a.loader=!1,a.shortcode=d.media.embed.shortcode({url:a.text})),a.shortcode.attrs&&a.shortcode.attrs.named&&a.shortcode.attrs.named.slug&&(b=a.shortcode.attrs.named.slug),d.ajax.post(a.action,{postID:f.postID,slug:b,type:a.shortcode.tag,shortcode:a.shortcode.string()}).done(function(b){a.render(b)}).fail(function(b){a.url?a.removeMarkers():a.setError(b.message||b.statusText,"admin-media")})},edit:function(a,b){if(this.shortcode.attrs&&this.shortcode.attrs.named){var c,d,e=this.shortcode.attrs.named,h=null;if((e.slug||e.id)&&(f.$.check.prop("checked",e.line_numbers&&"false"!==e.line_numbers),e.slug||(h=f.$.select.find('[data-id="'+e.id+'"]'),e.slug=h.attr("value")),f.$.select.val(e.slug),f.mainBtn().text(f.l10n.btn_update),f.open(b),this.content.snippet&&this.content.snippet.post_content)){var i=g.editor.getSession();if(d=this.content.snippet,g.editor.resize(),i.setValue(d.post_content,-1),f.$.snippetContent.val(d.post_content),f.$.snippetTitle.val(d.post_title),f.$.snippetID.val(d.ID),d.categories.length)for(c=d.categories.length-1;c>=0;c--)l("in-snippet-categories-"+d.categories[c]).prop("checked",!0);d.tags.length&&l("new-tag-snippet-tags").val(d.tags.join(",")).next().click(),d.language.term_id&&(l("snippet-language").val(d.language.term_id),i.setMode("ace/mode/"+d.language.slug)),f.showAddNew()}}}},f.init=function(){f.cache();var g={};g[f.l10n.btn_cancel]=f.cancel,f.$.none.length||(g[f.l10n.btn_insert]=f.insert),f.$.formWrap.dialog({resizable:!0,dialogClass:"wp-dialog snippet-cpt-dialog",modal:!0,autoOpen:!1,draggable:!0,height:"auto",width:"calc( 100% - 100px )",closeOnEscape:!0,buttons:g,create:f.create,close:f.close}),d.mce&&d.mce.views&&d.mce.views.register("snippet",f.mceView),e.addButton("snippetcpt",f.l10n.button_name,function(){a.codeSnippetCPTButton.open()}),c(b.body).on("click","input.add-new-snippet-btn",f.showAddNew).on("click","input.cancel-new-snippet-btn",f.cancelAddNew),c(".new-snippet-content-wrap").addClass("hidden")},c(f.init)}(window,document,jQuery,window.wp,window.QTags,window.codeSnippetCPTButton,window.snippetcpt);